<div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
  <div class="sm:mx-auto sm:w-full sm:max-w-md">
    <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
      <%= @form.title %>
    </h2>
    <p class="mt-2 text-center text-sm text-gray-600">
      <%= @form.description %>
    </p>
  </div>

  <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
    <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-lg font-medium leading-6 text-gray-900">
          Question <%= @current_index + 1 %> of <%= @total_questions %>
        </h3>
        <span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800">
          <%= @question.question_type %>
        </span>
      </div>

      <div class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-gray-700">
            <%= @question.question_text %>
            <% if @question.required? %>
              <span class="text-red-500">*</span>
            <% end %>
          </label>

          <%= form_tag answer_public_form_question_path(form_public_token: @form.public_token, id: @question.id), method: :post, data: { turbo_frame: "_top" } do %>
            <div class="mt-1">
              <% case @question.question_type.to_sym %>
              <% when :text %>
                <%= text_field_tag :response, session.dig(:form_responses, @question.id.to_s),
                    class: "shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",
                    required: @question.required? %>

              <% when :textarea %>
                <%= text_area_tag :response, session.dig(:form_responses, @question.id.to_s),
                    class: "shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",
                    rows: 4,
                    required: @question.required? %>

              <% when :number %>
                <%= number_field_tag :response, session.dig(:form_responses, @question.id.to_s),
                    class: "shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",
                    required: @question.required? %>

              <% when :email %>
                <%= email_field_tag :response, session.dig(:form_responses, @question.id.to_s),
                    class: "shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",
                    required: @question.required? %>

              <% when :date %>
                <%= date_field_tag :response, session.dig(:form_responses, @question.id.to_s),
                    class: "shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md",
                    required: @question.required? %>

              <% when :select %>
                <%= select_tag :response,
                    options_for_select(@question.options, session.dig(:form_responses, @question.id.to_s)),
                    class: "mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",
                    required: @question.required? %>

              <% when :radio %>
                <div class="mt-4 space-y-4">
                  <% @question.options.each do |option| %>
                    <div class="flex items-center">
                      <%= radio_button_tag :response, option, session.dig(:form_responses, @question.id.to_s) == option,
                          class: "focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300",
                          required: @question.required? %>
                      <%= label_tag "response_#{option.parameterize}", option, class: "ml-3 block text-sm font-medium text-gray-700" %>
                    </div>
                  <% end %>
                </div>

              <% when :checkbox %>
                <div class="mt-4 space-y-4">
                  <% @question.options.each do |option| %>
                    <div class="flex items-center">
                      <%= check_box_tag "response[]", option,
                          (session.dig(:form_responses, @question.id.to_s) || []).include?(option),
                          class: "focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded",
                          required: @question.required? %>
                      <%= label_tag "response_#{option.parameterize}", option, class: "ml-3 block text-sm font-medium text-gray-700" %>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>

            <div class="mt-8 flex justify-between">
              <% if @current_index > 0 %>
                <%= link_to "Back", public_form_question_path(@form.public_token, @form.questions.order(:order)[@current_index - 1]),
                    class: "inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",
                    data: { turbo_frame: "_top" } %>
              <% end %>

              <%= submit_tag @next_question ? "Next" : "Review Answers",
                  class: "ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
